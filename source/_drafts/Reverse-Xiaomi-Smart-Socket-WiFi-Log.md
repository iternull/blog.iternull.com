---
title: 硬件安全分析日志-小米智能插座基础版
date: 2017-02-28 03:46:01
tags:
  - Reverse Engineering
  - Hardware
  - Xiaomi
---

这是一篇对小米智能插座基础版做硬件安全逆向工程的日志，不定期更新逆向工程的操作记录。
<!--more-->
## 2017/02/28

> * 对“米家APP”进行流量抓包。

在中国版大菠萝 (WiFi Pineapple) 上挂载外接 U 盘，让安装了“米家APP” 的手机连接到 WiFi Pineapple 的 WiFi，SSH 登陆到 WiFi Pineapple 上使用 `tcpdump` 对无线网卡上所有的流量进行抓包并保存到 U 盘上。
通过 `scp` 复制到 PC 机上使用 `Wireshark` 打开 `.cap` 包进行初略查看。

> * 对“小米智能插座基础版”进行流量抓包

硬件定位服务端用得是域名而非固定 IP，硬件与服务端的全部通信用得都是 UDP 协议，找到了控制电源开或关时候的通信数据包（4 次传输），用得好像不是我之前猜测的 MQTT 协议，目前还没法确定这是什么协议或服务的数据，也没法解码。

> * 对设备进行本地局域网使用测试

在未连接互联网的情况下依旧可以在局域网中使用，而无需服务端。再从新接入互联网后“米家APP”会把通过 APP 操作的设备操作日志同步到服务端上，而直接再硬件上操作的记录并不会做记录或保存记录。
连接互联网后最后一条操作记录以设备当时的运行状态决定，时间戳为成功连接互联网时的时间，其之前手动在硬件上得所有操作都不会被记录。
当硬件在电源开启的情况下连接不上第一次配置时所设置的 WiFi 的时候，指示灯会不停的闪。

----------

由于硬件还要使用所以不能拆机调试。还缺少对硬件调试所需的很多工具，暂时无法进行下一步操作。
